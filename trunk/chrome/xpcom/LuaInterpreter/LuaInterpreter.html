<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
	<head>
		<title>Test Lua Interpreter</title>
		<script type="application/javascript">
			
			const cid = "@mshine.googlecode.com/MoonshineLua;1";
			var lua = null;
				
			function returnVersion() {
				
				netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
				lua = Components.classes[cid].createInstance();
				lua = lua.QueryInterface(Components.interfaces.ILuaInterpreter);
				alert(lua.ReturnVersion());
			}
			
			function returnLuaVersion() {
				
				netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
				lua = Components.classes[cid].createInstance();
				lua = lua.QueryInterface(Components.interfaces.ILuaInterpreter);
				alert(lua.ReturnLuaVersion());
			}
			
			function executeCommand() {
				
				netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
				lua = Components.classes[cid].createInstance();
				lua = lua.QueryInterface(Components.interfaces.ILuaInterpreter);
				var command = prompt('Enter a Lua or Moonshine API command:','return "hello from lua"');
				var returned = lua.ExecuteCommand(command);
				alert(returned);
			}
			
			function executeScript() {
				netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
				var nsIFilePicker = Components.interfaces.nsIFilePicker;
				var fp = Components.classes["@mozilla.org/filepicker;1"].createInstance(nsIFilePicker);
				fp.init(window, "Execute script", nsIFilePicker.modeOpen);
				fp.appendFilter("Lua/Moonshine scripts (*.lua)", "*.lua");
				fp.show();
	
				lua = Components.classes[cid].createInstance();
				lua = lua.QueryInterface(Components.interfaces.ILuaInterpreter);
				var returned = lua.ExecuteScript(fp.file.path);
				alert(returned);
			}
			
			</script>
		</head>
		<body>
			<fieldset>
				<input type="button" value="Return component version" onclick="returnVersion();"/>
				<input type="button" value="Return component version" onclick="returnLuaVersion();"/>
				<input type="button" value="Execute command" onclick="executeCommand();"/>
				<input type="button" value="Execute script" onclick="executeScript();"/>
			</fieldset
		</body>
	</html>
